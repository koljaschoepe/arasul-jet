# Docker Compose Override for Docker Secrets
# Use this file in production with: docker-compose -f docker-compose.yml -f docker-compose.secrets.yml up -d

version: '3.8'

secrets:
  postgres_password:
    file: ./config/secrets/postgres_password
  minio_root_password:
    file: ./config/secrets/minio_root_password
  jwt_secret:
    file: ./config/secrets/jwt_secret
  n8n_encryption_key:
    file: ./config/secrets/n8n_encryption_key

services:
  postgres-db:
    secrets:
      - postgres_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password

  minio:
    secrets:
      - minio_root_password
    environment:
      MINIO_ROOT_PASSWORD_FILE: /run/secrets/minio_root_password

  dashboard-backend:
    secrets:
      - postgres_password
      - jwt_secret
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
      JWT_SECRET_FILE: /run/secrets/jwt_secret

  n8n:
    secrets:
      - n8n_encryption_key
    environment:
      N8N_ENCRYPTION_KEY_FILE: /run/secrets/n8n_encryption_key

  metrics-collector:
    secrets:
      - postgres_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password

  self-healing-agent:
    secrets:
      - postgres_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
