#!/bin/sh

# Arasul Platform - Pre-push Hook
# Runs tests before pushing to remote

echo "Running pre-push checks..."

# Check if we're pushing to main or develop
current_branch=$(git symbolic-ref HEAD 2>/dev/null | cut -d"/" -f 3)

if [ "$current_branch" = "main" ] || [ "$current_branch" = "develop" ]; then
  echo "Pushing to $current_branch - running full test suite..."

  # Run backend tests
  if [ -f "./scripts/run-tests.sh" ]; then
    ./scripts/run-tests.sh --backend
    if [ $? -ne 0 ]; then
      echo ""
      echo "ERROR: Tests failed! Push aborted."
      echo "Please fix failing tests before pushing to $current_branch."
      echo ""
      exit 1
    fi
  fi
fi

echo "Pre-push checks passed!"
exit 0
